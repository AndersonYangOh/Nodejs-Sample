h1 My Friends
ul#people
  each name in names
    li(class='person')
      a(id='person-#{name}', href='#') #{name}
#person
  h2 name of the selected person
  input#txtNewNote(type='text')
  a#addNote(href='#') Add Note
  ul#notes

script(src="/javascripts/jquery-1.6.4.min.js")
script

  function addNote(note) {
    $('<li>').appendTo('#notes').text(note);
  }

  $(function() {
    $('#person').hide();
  
    $('li.person a').click(function() {
    
      var name = $(this).text();
      
      $('#person h2').text(name);
    
      $('#notes li').remove();
      
      $.getJSON('/person/' + name, function(data) {
        for (var i = 0; i < data.length; i++) {
          addNote(data[i]);
        }
      });
      
      $('#person').show();
      
      return false;
    });
    
    $('#addNote').click(function() {
      
      var name = $('#person h2').text();
      var note = $('#txtNewNote').val();
    
      $.ajax({
        type: "POST",
        url: "/person/addNote",
        data: JSON.stringify({ name: name, note: note }),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(data) {
          addNote(note);
          $('#txtNewNote').val('');
        },
        error: function(err) {
          var msg = 'Status: ' + err.status + ': ' + err.responseText;
          alert(msg);
        }
      });
      return false;
    });
  });
